<div [ngClass]="marcaClass">

  <div class="products-container">
    @if (productoSeleccionado) {
      @if (productoSeleccionado.TIPO !== 'C') {
        <div class="product-card">
          <h2>{{ productoSeleccionado.DESC }}</h2>
          <img 
            class="product-img" 
            [src]="getImagenProducto(productoSeleccionado.COD)" 
            [alt]="productoSeleccionado.DESC" 
          />
          <p class="ingredientes-titulo">Ingredients before baking</p>
          <p class="elaboration-text">{{ productoSeleccionado.ELABORACION }}</p>

          <div class="ingredients-list">
            @for (ingrediente of obtenerIngredientes(productoSeleccionado); track ingrediente; let j = $index) {
              @if (j > 0 && obtenerIngredientes(productoSeleccionado)[j - 1].CAPA < 21 && ingrediente.CAPA >= 21) {
                <hr class="ingredientes-separador">
                <p class="ingredientes-titulo">Ingredients after baking</p>
              }

              <div class="ingredient-row">
                <img 
                  class="ingredient-img" 
                  [src]="getImagenIngrediente(ingrediente.COD, productoSeleccionado.MARCA)"
                  [alt]="ingrediente.DESC" 
                />
                <div class="ingredient-line"></div>
                <span class="ingredient-label">{{ ingrediente.DESC }} ({{ ingrediente.CANTIDAD }} {{ ingrediente.UNIDAD }})</span>
              </div>
            }
          </div>
        </div>
      }

      @if (productoSeleccionado.TIPO === 'C') {
        <div class="product-card mitad-mitad">
          <h2>{{ productoSeleccionado.DESC }}</h2>
          <p class="elaboration-text">{{ productoSeleccionado.ELABORACION }}</p>

          <div class="halves-container">
            @for (mitad of productoSeleccionado.ARRAY_COMPOSICION; track mitad; let k = $index) {
              <div class="half-card">
                <h3>{{ mitad.DESC }}</h3>
                <img 
                  class="product-img" 
                  [src]="getImagenProducto(mitad.COD)" 
                  [alt]="mitad.DESC" 
                  style="width: 100%; max-width: 250px;"
                />
                <p class="ingredientes-titulo">Ingredients before baking</p>
                <div class="ingredients-list">
                  @for (ingrediente of obtenerIngredientes(mitad); track ingrediente; let j = $index) {
                    @if (j > 0 && obtenerIngredientes(mitad)[j - 1].CAPA < 21 && ingrediente.CAPA >= 21) {
                      <hr class="ingredientes-separador">
                      <p class="ingredientes-titulo">Ingredients after baking</p>
                    }

                    <div class="ingredient-row">
                      <img 
                        class="ingredient-img" 
                        [src]="getImagenIngrediente(ingrediente.COD, productoSeleccionado.MARCA)"
                        [alt]="ingrediente.DESC" 
                      />
                      <div class="ingredient-line"></div>
                      <span class="ingredient-label">{{ ingrediente.DESC }} ({{ ingrediente.CANTIDAD }} {{ ingrediente.UNIDAD }})</span>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }
    }
  </div>
</div>